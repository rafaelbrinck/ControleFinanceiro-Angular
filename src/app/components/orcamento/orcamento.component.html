<div class="container my-5">
  <div class="card shadow rounded-4">
    <div class="card-body p-4">
      <h2 class="mb-4 fw-bold text-primary text-center">Produtos</h2>

      <div class="input-group mb-4 shadow-sm">
        <span class="input-group-text bg-white border-end-0">
          <i class="bi bi-search text-secondary"></i>
        </span>
        <input
          type="text"
          [(ngModel)]="nomePesquisa"
          id="nomePesquisa"
          class="form-control form-control-lg border-start-0"
          placeholder="Digite para pesquisar..."
          aria-label="Pesquisar transações"
        >
      </div>

      <div *ngIf="(listaProdutos | buscador:nomePesquisa:['nome']).length === 0" class="alert alert-light text-center shadow-sm rounded p-4">
        <i class="bi bi-exclamation-circle fs-3 text-secondary d-block mb-2"></i>
        <span class="fs-5 text-muted">Nenhum produto encontrado</span>
      </div>

      <div class="table-responsive" *ngIf="(listaProdutos | buscador:nomePesquisa:['nome']).length > 0">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light text-center">
            <tr>
              <th scope="col" class="text-center">NOME</th>
              <th scope="col" class="text-center">VALOR</th>
              <th scope="col" class="text-center">AÇÃO</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let produto of (listaProdutos | buscador:nomePesquisa:['nome'])" class="text-center">
              <td class="text-center">{{ produto.nome }}</td>
              <td>{{ produto.valor | moeda }}</td>
              <td class="text-center">
                <button
                  class="btn btn-sm btn-outline-primary"
                  (click)="adicionarProduto(produto.id)"
                  type="button"
                >
                  <i class="bi bi-cart-check"></i> Adicionar
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<!-- Footer Carrinho / Orçamento -->
<div class="fixed-bottom bg-white border-top shadow-lg">
  <div class="container py-2">
    <!-- Cabeçalho do Carrinho -->
    <div class="d-flex justify-content-between align-items-center" (click)="mostrarDetalhes = !mostrarDetalhes" style="cursor: pointer;">
      <div>
        <i class="bi bi-cart3 me-2"></i>
        <strong>{{ totalProdutosCarrinho }} produto(s)</strong>
      </div>
      <div class="fw-semibold text-primary">
        Total: {{ total | currency:'BRL' }}
        <i class="bi" [ngClass]="mostrarDetalhes ? 'bi-chevron-down' : 'bi-chevron-up'"></i>
      </div>
    </div>

    <!-- Lista de Produtos (visível somente se mostrarDetalhes for true) -->
    <<div *ngIf="mostrarDetalhes" class="mt-3 border-top pt-3">
        <div *ngFor="let produto of produtosOrcamento" class="d-flex justify-content-between align-items-center mb-3 px-1">
            
            <!-- Ícone de Remover -->
            <button
            class="btn btn-sm btn-outline-danger d-flex align-items-center"
            (click)="removerProduto(produto.id)"
            title="Remover produto"
            >
            <i class="bi bi-trash"></i>
            </button>

            <!-- Informações do Produto -->
            <div class="flex-grow-1 px-3">
            <div class="fw-semibold">{{ produto.nome }}</div>
            <div class="text-muted small">{{ produto.quantidade }} x {{ produto.valor | currency:'BRL' }}</div>
            </div>

            <!-- Valor Total do Produto -->
            <div class="fw-medium text-end text-success">
            {{ produto.quantidade * produto.valor | currency:'BRL' }}
            </div>
        </div>
        <!-- Resumo financeiro do orçamento -->
        <div class="mt-4 border-top pt-3">
        <div class="d-flex justify-content-between mb-2">
            <span class="fw-semibold">Valor total:</span>
            <span class="fw-bold text-primary">{{ total | currency:'BRL' }}</span>
        </div>

        <div class="d-flex align-items-center justify-content-between mb-3">
            <span class="fw-semibold">Parcelado (5x sem juros):</span>
            <div class="flex-grow-1 px-3 text-end" style="margin-right: -16px;">
                <div class="fw-semibold text-success">
                {{ totalParcelamento | currency:'BRL' }}
                </div>
                <div class="text-muted small">
                {{ (totalParcelamento / 5) | currency:'BRL' }} x 5
                </div>
            </div>
        </div>


        <!-- Botões de ação -->
        <div class="d-flex gap-2 justify-content-end">
            <button class="btn btn-outline-secondary" (click)="adicionarCliente()">
            <i class="bi bi-person-plus me-1"></i> Adicionar Cliente
            </button>
            <button class="btn btn-primary" (click)="finalizarOrcamento()">
            <i class="bi bi-send-check me-1"></i> Finalizar Orçamento
            </button>
        </div>
        </div>

    </div>

  </div>
</div>
